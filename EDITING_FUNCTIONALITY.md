# Функционал редактирования оценок членами жюри

## Обзор

Система предоставляет возможность членам жюри редактировать уже выставленные оценки для всех конкурсов. Это позволяет исправлять ошибки, изменять оценки при пересмотре или обновлять данные по мере необходимости.

## Основные возможности

### 1. Режим редактирования
- При выборе команды с существующей оценкой автоматически активируется режим редактирования
- В интерфейсе появляется индикатор "(режим редактирования)"
- Заголовок формы меняется для отражения текущего режима

### 2. Отслеживание изменений
- Система автоматически отслеживает все изменения в форме
- Кнопка "Обновить оценку" активируется только при наличии несохраненных изменений
- Предупреждение о несохраненных изменениях отображается при попытке переключения команд

### 3. Управление состоянием
- Возможность отменить изменения и вернуться к исходным значениям
- Автоматический сброс индикаторов изменений при сохранении или отмене
- Сохранение текущего состояния при переключении между командами

## Поддерживаемые конкурсы

### 1. Конкурс "Визитка" (visit-card)
- Поля для редактирования:
  - Целостность выступления (0-2 балла)
  - Культура выступления и сплоченность (0-1 балл)
  - Творческие способности и артистизм (0-2 балла)
  - Оригинальность выступления (0-1 балл)
  - Штраф за превышение времени

### 2. Конкурс "Клинический случай" (clinical-case)
- Поля для редактирования:
  - Ответ на вопросы задачи (0-3 балла)
  - Досрочное завершение (+1 балл)

### 3. Конкурс "Практические навыки" (practical-skills)
- Станция "Швы при кесаревом сечении":
  - Эстетичность (0-3 балла)
  - Адаптация краев раны (0-4 балла)
  - Работа с инструментами (0-3 балла)
  - Время выполнения (0-2 балла)

- Станция "Амбулаторный прием":
  - Профессионализм и подготовка (0-3 балла)
  - Техника выполнения и коммуникация (0-5 баллов)
  - Завершение приема и информирование (0-4 балла)

- Станция "Акушерское пособие":
  - Правильные моменты (0-5 баллов)
  - Безопасность манипуляций (0-3 балла)
  - Время выполнения (0-2 балла)
  - Слаженность работы бригады (0-2 балла)

- Станция "Лапароскопический симулятор":
  - Транслокация предметов (0-4 балла)
  - Координация с двумя инструментами (0-4 балла)
  - Наведение на цель (0-4 балла)
  - Парковка инструмента (0-4 балла)

### 4. Конкурс "Битва умов" (mind-battle)
- Поля для редактирования:
  - Ответ команды (0-2 балла)

### 5. Конкурс "Вопрос от жюри" (jury-question)
- Поля для редактирования:
  - Ответ команды (0-2 балла)

## Порядок действий при редактировании

1. **Выбор команды**: Нажмите на кнопку оценки для команды, которую хотите редактировать
2. **Режим редактирования**: Система автоматически определит наличие существующей оценки и перейдет в режим редактирования
3. **Внесение изменений**: Измените необходимые значения в форме
4. **Сохранение изменений**: Нажмите кнопку "Обновить оценку" для сохранения изменений
5. **Отмена изменений**: Нажмите кнопку "Отменить изменения" для возврата к исходным значениям

## Визуальные индикаторы

### Индикаторы режима редактирования
- Заголовок формы содержит текст "(режим редактирования)"
- Кнопка сохранения показывает "Обновить оценку" вместо "Сохранить оценку"
- При наличии несохраненных изменений появляется предупреждение

### Предупреждения
- "Есть несохраненные изменения. Сохраните их перед переключением команды."
- Отображается при попытке переключения на другую команду с несохраненными изменениями

## Техническая реализация

### Управление состоянием
```typescript
const [isEditing, setIsEditing] = useState(false);
const [hasUnsavedChanges, setHasUnsavedChanges] = useState(false);
```

### Отслеживание изменений
```typescript
onChange={(e) => {
  setCurrentScore({...currentScore, field: Number(e.target.value)});
  setHasUnsavedChanges(true);
}}
```

### Загрузка существующей оценки
```typescript
const loadScore = (teamId: string) => {
  if (scores[teamId]) {
    setCurrentScore(scores[teamId]);
    setIsEditing(true);
  } else {
    // Новая оценка
    setIsEditing(false);
  }
  setSelectedTeam(teamId);
  setHasUnsavedChanges(false);
};
```

## Безопасность и целостность данных

- Все изменения сохраняются на сервере через API
- При обновлении оценки старые значения перезаписываются
- Система автоматически пересчитывает агрегированные баллы
- Сохраняется история изменений для аудита

## Тестирование

Для проверки функционала редактирования используется автоматизированный тест:
```bash
cd medical-competition && node src/tests/test-editing-functionality.js
```

Тест проверяет:
- Наличие всех необходимых функций редактирования
- Корректность управления состоянием
- Полноту UI элементов для редактирования
- Синтаксическую корректность TypeScript кода

## Ограничения

- Редактирование доступно только для авторизованных членов жюри
- Каждое изменение перезаписывает предыдущее значение
- При одновременном редактировании одним членом жюри сохраняется последнее изменение